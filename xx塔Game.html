<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>XX塔Game</title>
</head>
<style type="text/css" rel="stylesheet">
    *{
        margin: 0 auto;
    }
    .gameDiv{
        width: 298px;
        border-left: 1px solid #3dafff;
        border-bottom: 1px solid #3dafff;
        border-right: 1px solid #3dafff;
        height: 220px;
        float: left;
    }
</style>
<script>
    var timer = null;
    window.onload = function(){
        //定时器设定
        var hours = "",
            minute = "",
            second = "",
            start = document.getElementById("start"),
            time = document.getElementById("time"),
            level = document.getElementById("level"),
            count = document.getElementById("count"),
            Hours = 0,
            Minute = 0,
            Second = 0;
        //绑定开始结束的点击事件
        start.onclick = function(){
            var text = start.innerText;
            if(text == "开始") {
                //修改button文字信息
                start.innerText = "结束";
                //难度锁定，不可在改变
                level.setAttribute("disabled","");
                //初始化界面
                initGame(level.value);
                //定时器启动
                timer = setInterval(function () {
                    Second++;
                    if (Second > 59) {
                        Second = 0;
                        Minute++;
                        if (Minute > 59) {
                            Minute = 0;
                            Hours++;
                        }
                    }
                    if (Second < 10) {
                        second = "0" + Second;
                    } else {
                        second = "" + Second;
                    }
                    if (Minute < 10) {
                        minute = "0" + Minute;
                    } else {
                        minute = "" + Minute;
                    }
                    if (Hours < 10) {
                        hours = "0" + Hours;
                    } else {
                        hours = "" + Hours;
                    }
                 var str = hours+":"+minute+":"+second;
                    time.innerText=str;
                }, 1000);
            }else{//等于结束
                //修改button文字信息
                start.innerText = "开始";
                //定时器消除,时间置零,次数置零
                clearInterval(timer);
                time.innerText="00:00:00";
                count.innerText="0";
                //让难度可选
                level.removeAttribute("disabled");
                //清除界面
                document.getElementById("fir").innerHTML="";
                document.getElementById("fir").setAttribute("divCount","0");
                document.getElementById("sec").innerHTML="";
                document.getElementById("sec").setAttribute("divCount","0");
                document.getElementById("tri").innerHTML="";
                document.getElementById("tri").setAttribute("divCount","0");
            }
        };
        //绑定拿起放下的点击事件
        var opDivs = document.getElementsByClassName("op");
        opDivs[0].onclick = function () {moveDiv(this);};
        opDivs[1].onclick = function () {moveDiv(this);};
        opDivs[2].onclick = function () {moveDiv(this);};
    }
    function moveDiv(who) {
        var opDivs = document.getElementsByClassName("op");
        var flag = who.innerHTML;
        var divIp = who.getAttribute("divIp");
        if(flag == "拿起") {
            opDivs[0].innerHTML = "放下";
            opDivs[1].innerHTML = "放下";
            opDivs[2].innerHTML = "放下";
            opDivs[divIp].innerHTML = "拿起";
        }else{
             //先找到来源，即找到"拿起"。。。
            var source = null;
            for(var  i = 0;i<opDivs.length;i++){
                if(opDivs[i].innerHTML == "拿起"){
                    source = opDivs[i];
                    break;
                }
            }
            //获取源和目标对应的区域
            var sourceIp = source.getAttribute("divIp");
            var targetIp = divIp;
            var gameDivs = document.getElementsByClassName("gameDiv");
            var sourceGameDiv = gameDivs[sourceIp];
            var targetGameDiv = gameDivs[targetIp];
            //开始移动
            var sourceGameDivCount = sourceGameDiv.getAttribute("divCount");
            var targetGameDivCount = targetGameDiv.getAttribute("divCount");
            if(sourceGameDivCount <= 0){ //代表没有方块可用来移动
                //重置
                opDivs[0].innerHTML = "拿起";
                opDivs[1].innerHTML = "拿起";
                opDivs[2].innerHTML = "拿起";
                return;
            }
            //获取双方的第一块，比较宽度
            var sourceFirWidth = sourceGameDiv.getElementsByTagName("div")[0].style.width.split("px")[0];
            var targetFirWidth = 10000;//
            if(targetGameDivCount >0){//说明存在方块
                targetFirWidth = targetGameDiv.getElementsByTagName("div")[0].style.width.split("px")[0];
            }
            console.info( sourceFirWidth+"" +targetFirWidth);
            if(sourceFirWidth < targetFirWidth){//源小于目标，可以移动
                removeDiv(sourceGameDiv);
                createDiv(targetGameDiv,sourceFirWidth);
                //次数+1
              var c1  = document.getElementById("count").innerHTML ;
              c1++;
              document.getElementById("count").innerHTML = c1;
            }else {
                alert("长度不对，无法移动");
            }
                //重置
                opDivs[0].innerHTML = "拿起";
                opDivs[1].innerHTML = "拿起";
                opDivs[2].innerHTML = "拿起";
            //判断游戏是否结束
            var gameOverDiv = gameDivs[2];
            var gameOverDivCount = gameOverDiv.getAttribute("divCount");
            var winCount = document.getElementById("level").value;//等级
            if(gameOverDivCount == winCount){
                alert("you win");
                //获取游戏数据
                var winTime =document.getElementById("time").innerHTML;//时间
                var winAllCount = document.getElementById("count").innerHTML;//次数
                //重置游戏................................................
                //修改button文字信息
                document.getElementById("start").innerText = "开始";
                //定时器消除,时间置零,次数置零
                clearInterval(timer);
                document.getElementById("time").innerHTML="00:00:00";
                document.getElementById("count").innerHTML="0";
                //让难度可选
                document.getElementById("level").removeAttribute("disabled");
                //清除界面
                document.getElementById("fir").innerHTML="";
                document.getElementById("fir").setAttribute("divCount","0");
                document.getElementById("sec").innerHTML="";
                document.getElementById("sec").setAttribute("divCount","0");
                document.getElementById("tri").innerHTML="";
                document.getElementById("tri").setAttribute("divCount","0");
            }
        }
    }
    function initGame(level) {
        var who = document.getElementById("fir");
        var maxLen = level*20;
        for(var len = maxLen;len>=20;len =len-20){
            createDiv(who,len);
        }
        console.info(maxLen);
    }
    function createDiv(who,len) {
        var colors=[{"len":180,"color":"#34ffa8"},{"len":160,"color":"#f8ff23"},{"len":140,"color":"#ff742a"},
            {"len":120,"color":"#ff4157"},{"len":100,"color":"#ff3ad7"},{"len":80,"color":"#8c23ff"},
            {"len":60,"color":"#2746ff"},{"len":40,"color":"#c4c0ff"},{"len":20,"color":"#828282"}];
        var divCount = who.getAttribute("divCount");
        var firDiv = null;
        var myColor = "blue";
        for(var i=0;i<colors.length;i++){
            if(len == colors[i].len){
                myColor = colors[i].color;
            }
        }
        if(divCount != 0){//说明至少有一块div
            firDiv = who.getElementsByTagName("div")[0];
            //去除第一块的定位样式
            firDiv.style.marginTop="0px";
        }
        var top = 200-divCount*20;
        var strDiv= "<div style='margin-top: "+top+"px;width: "+len+"px;height:20px;background: "+myColor+"'></div>"
        var oldDiv= who.innerHTML;
        who.innerHTML = strDiv+oldDiv;
        //div计数加一
        divCount++;
        who.setAttribute("divCount",""+divCount)
    }
    function removeDiv(who) {
        var divCount = who.getAttribute("divCount");
        if(divCount == 0){//没有就直接返回
            return;
        }
        //移除div
        var oldDiv= who.innerHTML;
        who.innerHTML = oldDiv.substr(oldDiv.indexOf("</div>"),oldDiv.length);
        //div计数减一
        divCount--;
        who.setAttribute("divCount",""+divCount);
        //设置第一个div的样式
        if(divCount != 0){

            var firDiv = who.getElementsByTagName("div")[0];
            firDiv.style.marginTop = (220-20*divCount)+"px";
            return;
        }
    }
</script>
<body>
<div id="heard" style="width: 500px">
<div>GameRule：</div>
    <div style="float: left">
        <label for="level">难度选择</label><select id="level">
        <option value="1">1</option><option value="3">3</option><option value="5">5</option><option value="7">7</option><option value="9">9</option></select>
    </div>
    <div style="float: left">
        <label for="time">时间：</label><label id="time">00:00:00</label>
        <label for="count">移动次数：</label><label id="count">0</label>
        <button id="start">开始</button>
    </div>
</div>
<div id="content" style="margin-top:80px;width: 900px;height: 240px;">
    <div id="fir" class="gameDiv" divCount="0"></div><div id="sec" class="gameDiv"  divCount="0"></div><div id="tri" class="gameDiv"  divCount="0"></div>
    <div class="op"  style="width: 298px;height: 20px;float: left;text-align: center;border: 1px solid #ff083c" divIp="0">拿起</div>
    <div class="op"  style="width: 298px;height: 20px;float: left;text-align: center;border: 1px solid #ff083c" divIp="1">拿起</div>
    <div class="op"  style="width: 298px;height: 20px;float: left;text-align: center;border: 1px solid #ff083c" divIp="2">拿起</div>
</div>
<div id="mengban">
    <label>难度等级：</label><label id="winLevel"></label>
    <label>移动次数：</label><label id="moveTimes"></label>
    <label>花费时间：</label><label id="costTime"></label>
    <label>最总评价：</label><label id="lastComment">emmmm~~~实属绿色~~~</label><!--规则暂未拟定未定-->
</div>
</body>
</html>